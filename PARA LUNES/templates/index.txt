<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management v1.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f4f4; }
        .header { background-color: #3f51b5; color: white; padding: 15px; }
        .form-container { background: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .table-container { background: white; padding: 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* Image Picker Styles */
        .image-preview-container {
            width: 150px; height: 150px;
            margin: 0 auto 20px;
            position: relative;
            border: 2px dashed #ddd;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; overflow: hidden;
            background-color: #f9f9f9;
        }
        .image-preview-container img { width: 100%; height: 100%; object-fit: cover; }
        .image-upload-input { display: none; } /* Hide actual input */
        
        /* Footer */
        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="header">
    <h4>Student Management v1.0</h4>
</div>

<div class="container-fluid mt-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-md-4">
            <div class="form-container">
                <h5 class="mb-3 border-bottom pb-2">STUDENT INFORMATION</h5>
                
                <form action="/save" method="POST" enctype="multipart/form-data" id="studentForm">
                    <input type="hidden" name="id" id="studentId"> <div class="image-preview-container" onclick="document.getElementById('imageInput').click()">
                        <img id="previewImage" src="https://via.placeholder.com/150?text=Select+Image" alt="Profile">
                    </div>
                    <input type="file" name="image" id="imageInput" class="image-upload-input" accept="image/*" onchange="previewFile()">
                    <div class="text-center text-muted small mb-3">Click image to upload</div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">IDNO</label>
                        <input type="text" class="form-control" name="idno" id="idno" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">LASTNAME</label>
                        <input type="text" class="form-control" name="lastname" id="lastname" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">FIRSTNAME</label>
                        <input type="text" class="form-control" name="firstname" id="firstname" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">COURSE</label>
                        <select class="form-select" name="course" id="course" required>
                            <option value="BSIT">BSIT</option>
                            <option value="BSCS">BSCS</option>
                            <option value="BSCPE">BSCPE</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">LEVEL</label>
                        <select class="form-select" name="level" id="level" required>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <button type="submit" class="btn btn-primary">SAVE</button>
                        <button type="button" class="btn btn-info text-white" onclick="resetForm()">CANCEL</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="col-md-8">
            <div class="table-container">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>IDNO</th>
                                
                                <th class="d-none d-md-table-cell">LASTNAME</th>
                                <th class="d-none d-md-table-cell">FIRSTNAME</th>
                                <th class="d-none d-md-table-cell">COURSE</th>
                                <th class="d-none d-md-table-cell">LEVEL</th>

                                <th class="d-md-none">NAME</th> <th class="d-md-none">COURSE & LEVEL</th> <th>ACTION</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for student in students %}
                            <tr>
                                <td>{{ student.idno }}</td>

                                <td class="d-none d-md-table-cell">{{ student.lastname }}</td>
                                <td class="d-none d-md-table-cell">{{ student.firstname }}</td>
                                <td class="d-none d-md-table-cell">{{ student.course }}</td>
                                <td class="d-none d-md-table-cell">{{ student.level }}</td>

                                <td class="d-md-none">
                                    <div><strong>{{ student.lastname }}</strong></div>
                                    <div>{{ student.firstname }}</div>
                                </td>
                                <td class="d-md-none">
                                    {{ student.course }} - {{ student.level }}
                                </td>

                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" 
                                            onclick="editStudent('{{ student.id }}', '{{ student.idno }}', '{{ student.lastname }}', '{{ student.firstname }}', '{{ student.course }}', '{{ student.level }}', '{{ student.image_file }}')">
                                        ‚úèÔ∏è
                                    </button>

                                    <form action="/delete/{{ student.id }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this record?');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; UC-CCS 2025 change with your name</p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Image Preview Logic
    function previewFile() {
        const preview = document.getElementById('previewImage');
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();

        reader.onloadend = function () {
            preview.src = reader.result;
        }

        if (file) {
            reader.readAsDataURL(file);
        } else {
            preview.src = "https://via.placeholder.com/150?text=Select+Image";
        }
    }

    // Edit Student Logic - Populates Form
    function editStudent(id, idno, lastname, firstname, course, level, imageFile) {
        document.getElementById('studentId').value = id;
        document.getElementById('idno').value = idno;
        document.getElementById('lastname').value = lastname;
        document.getElementById('firstname').value = firstname;
        document.getElementById('course').value = course;
        document.getElementById('level').value = level;
        
        if(imageFile && imageFile !== 'None') {
            document.getElementById('previewImage').src = "/static/uploads/" + imageFile;
        } else {
            document.getElementById('previewImage').src = "https://via.placeholder.com/150?text=No+Image";
        }
    }

    // Reset Form Logic (Cancel Button)
    function resetForm() {
        document.getElementById('studentForm').reset();
        document.getElementById('studentId').value = ''; // Clear ID to switch back to "Add" mode
        document.getElementById('previewImage').src = "https://via.placeholder.com/150?text=Select+Image";
    }
</script>

</body>
</html>